<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowerBloom Â· Your reflection, reimagined in bloom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
    <style>
        :root {
            --mag: #E6007E;
            --gold: #D4AF37;
            --charcoal: #2E2E2E;
            --soft-white: #FFFAFF;
        }
        body {
            background: var(--soft-white);
            font-family: 'Cormorant Garamond', serif;
            color: var(--charcoal);
            min-height: 100vh;
        }
        h1, h2, .playfair { font-family: 'Playfair Display', serif; }
        .mag { color: var(--mag); }
        .gold { color: var(--gold); }
        .gradient-bg {
            background: linear-gradient(135deg, #fff9ff 0%, #fff4fb 50%, #fef5ff 100%);
        }
        .iridescent {
            background: linear-gradient(90deg, #ffd1e9, #e6c3ff, #c3e6ff, #d1ffe6);
            background-size: 300% 300%;
            animation: shimmer 12s ease infinite;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        @keyframes shimmer { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        .petal-border { border: 1px solid rgba(230,0,126,0.15); }
        .glow { box-shadow: 0 0 30px rgba(230,0,126,0.15); }
    </style>
</head>
<body class="gradient-bg">

<div class="container max-w-5xl mx-auto p-6 lg:p-12">

    <!-- HERO / INVITATION WALL -->
    <header class="text-center py-16 lg:py-24 relative overflow-hidden rounded-3xl glow">
        <div class="absolute inset-0 opacity-10">
            <div class="absolute inset-0 iridescent"></div>
        </div>
        
        <h1 class="text-5xl lg:text-7xl font-bold playfair mb-6 leading-tight">
            Your reflection<br><span class="mag">is waiting to bloom.</span>
        </h1>
        
        <p class="text-2xl lg:text-4xl playfair italic gold mb-8 opacity-90">
            She took a selfie.<br>The flowers took over.
        </p>
        
        <p class="text-lg lg:text-xl max-w-2xl mx-auto mb-12 leading-relaxed opacity-80">
            Your photo becomes art â€” flowing between your wallpaper and your phone case.<br>
            <span class="gold">Watch it come alive before your eyes.</span>
        </p>

        <!-- Logo Lockup -->
        <div class="mb-12">
            <img src="https://via.placeholder.com/400x120/E6007E/FFFFFF?text=theweer.com+âœ¿" alt="theweer.com logo" class="mx-auto h-20">
        </div>

        <!-- QR + CTA -->
        <div class="flex flex-col items-center">
            <p class="text-lg mb-4 gold">Thereâ€™s something growing from your reflection.</p>
            <div class="bg-white p-8 rounded-3xl shadow-2xl petal-border">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://theweer.com" alt="Scan to bloom" class="w-48 h-48">
            </div>
            <p class="mt-4 text-sm opacity-70">ğŸŒ¸ Scan to see what blooms</p>
        </div>
    </header>

    <!-- POEM WALL (Manifesto) -->
    <section class="my-20 lg:my-32 text-center lg:text-left lg:flex lg:items-center lg:justify-between">
        <div class="max-w-3xl mx-auto lg:mx-0 leading-loose text-2xl lg:text-3xl italic">
            <p class="mb-8">You are not pixels or paper.</p>
            <p class="mb-8">You are motion and bloom.</p>
            <p class="mb-8">The flowers you wear are grown from your light.</p>
            <p class="mb-8">They drift between worlds â€”</p>
            <p class="mb-8">from your reflection,<br>to your phone,<br>to your hand.</p>
            <p class="mt-16 text-3xl lg:text-4xl playfair font-bold mag">
                This is not a phone case.<br>
                Itâ€™s a portrait of your bloom.
            </p>
        </div>
    </section>

    <!-- CORE TAGLINE LOCKUP -->
    <div class="text-center py-16 border-y-2 border-dashed border-pink-100 my-20">
        <h2 class="text-4xl lg:text-6xl playfair font-bold mb-4">
            Your reflection.<br><span class="mag">Reimagined in bloom.</span>
        </h2>
        <p class="text-xl italic gold">Where technology meets the tenderness of art.</p>
    </div>

    <!-- EXISTING APP (unchanged functionality, restyled) -->
    <div class="mt-20">
        <!-- All original functional HTML/JS from your previous code goes here, 
             but wrapped in the new aesthetic classes below for consistency -->
        <div class="bg-white/80 backdrop-blur rounded-3xl shadow-2xl p-8 lg:p-12 petal-border glow">
            <!-- Paste your entire original <header>, <div id="nav-container">, etc. here -->
            <!-- Only visual changes applied: fonts, colors, spacing, borders -->
            <!-- Functional JavaScript is 100% untouched -->

            <!-- Example of how your original header would now look inside the new theme -->
            <header class="header flex justify-between items-center pb-6 border-b-2 border-pink-100 mb-10">
                <h1 class="text-4xl playfair font-bold mag">FlowerBloom Cases</h1>
                <div id="auth-action"></div>
            </header>

            <div id="nav-container" class="mb-8"></div>
            <div id="token-display" class="text-sm font-medium mb-8 p-4 bg-pink-50/50 rounded-xl"></div>
            <div id="app-content"></div>
            <div id="auth-required-message" style="display:none;"></div>
        </div>
    </div>

</div>

<script>
Â Â Â Â Â Â Â Â // --- PKCE UTILITY FUNCTIONS (Unchanged from previous version, handles base64, sha256) ---
Â Â Â Â Â Â Â Â function base64urlencode(buffer){
Â Â Â Â Â Â Â Â Â Â Â Â const bytes = new Uint8Array(buffer);
Â Â Â Â Â Â Â Â Â Â Â Â let binary = '';
Â Â Â Â Â Â Â Â Â Â Â Â for (let i = 0; i < bytes.byteLength; i++) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â binary += String.fromCharCode(bytes[i]);
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â return btoa(binary)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .replace(/+/g, '-').replace(///g, '_').replace(/=+$/, '');
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â async function sha256(str){
Â Â Â Â Â Â Â Â Â Â Â Â const digest = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
Â Â Â Â Â Â Â Â Â Â Â Â return base64urlencode(digest);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â function genRandom(){
Â Â Â Â Â Â Â Â Â Â Â Â const arr = new Uint8Array(32);
Â Â Â Â Â Â Â Â Â Â Â Â crypto.getRandomValues(arr);
Â Â Â Â Â Â Â Â Â Â Â Â return base64urlencode(arr);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â // --- AUTH CONFIG & SESSION MANAGEMENT (Unchanged/Refined) ---
Â Â Â Â Â Â Â Â const cognitoConfig = {
Â Â Â Â Â Â Â Â Â Â Â Â clientId: '73lf1h32phkqeb9ahu6tqcl9av',
Â Â Â Â Â Â Â Â Â Â Â Â domain: 'auth.theweer.com',
Â Â Â Â Â Â Â Â Â Â Â Â redirectUri: window.location.origin + window.location.pathname,
Â Â Â Â Â Â Â Â Â Â Â Â tokenEndpoint: https://auth.theweer.com/oauth2/token
Â Â Â Â Â Â Â Â };
Â Â Â Â Â Â Â Â function saveSession(t){
Â Â Â Â Â Â Â Â Â Â Â Â localStorage.setItem('cognitoSession', JSON.stringify(t));
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â function getSession(){
Â Â Â Â Â Â Â Â Â Â Â Â const session = localStorage.getItem('cognitoSession');
Â Â Â Â Â Â Â Â Â Â Â Â return session ? JSON.parse(session) : null;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â function clearUserData() {
Â Â Â Â Â Â Â Â Â Â Â Â localStorage.removeItem('activePromoDiscount');
Â Â Â Â Â Â Â Â Â Â Â Â localStorage.removeItem('userUploads');
Â Â Â Â Â Â Â Â Â Â Â Â localStorage.removeItem('deviceSelection');
Â Â Â Â Â Â Â Â Â Â Â Â localStorage.removeItem('shoppingCart');
Â Â Â Â Â Â Â Â Â Â Â Â console.log('All user-specific data cleared');
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â function clearSession() {
Â Â Â Â Â Â Â Â Â Â Â Â localStorage.removeItem('cognitoSession');
Â Â Â Â Â Â Â Â Â Â Â Â localStorage.removeItem('pkce_verifier');
Â Â Â Â Â Â Â Â Â Â Â Â clearUserData();
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â function isTokenExpired(token) {
Â Â Â Â Â Â Â Â Â Â Â Â if (!token) return true;
Â Â Â Â Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const payload = JSON.parse(atob(token.split('.')[1]));
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const exp = payload.exp * 1000;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const now = Date.now();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const bufferTime = 300000; // 5 minutes buffer
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return now >= (exp - bufferTime);
Â Â Â Â Â Â Â Â Â Â Â Â } catch (e) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â console.error('Error checking token expiration:', e);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return true;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â async function refreshSession() {
Â Â Â Â Â Â Â Â Â Â Â Â const session = getSession();
Â Â Â Â Â Â Â Â Â Â Â Â if (!session || !session.refresh_token) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â clearSession();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return false;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â // ... [refresh logic remains the same]
Â Â Â Â Â Â Â Â Â Â Â Â const body =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â grant_type=refresh_token
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &client_id=${cognitoConfig.clientId}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &refresh_token=${session.refresh_token};
Â Â Â Â Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const res = await fetch(cognitoConfig.tokenEndpoint,{
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method: 'POST',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â headers: {'Content-Type': 'application/x-www-form-urlencoded'},
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â body
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const tokens = await res.json();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if(res.ok && tokens.id_token) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const newSession = {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...tokens,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â refresh_token: tokens.refresh_token || session.refresh_token
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â saveSession(newSession);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return true;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â clearSession();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return false;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â } catch (error) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â console.error('Network or exchange error during refresh:', error);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return false;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â async function isAuthenticated() {
Â Â Â Â Â Â Â Â Â Â Â Â const session = getSession();
Â Â Â Â Â Â Â Â Â Â Â Â if (!session || !session.id_token) return false;
Â Â Â Â Â Â Â Â Â Â Â Â if (isTokenExpired(session.id_token)) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return await refreshSession();
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â return true;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â function getUserInfo() {
Â Â Â Â Â Â Â Â Â Â Â Â const session = getSession();
Â Â Â Â Â Â Â Â Â Â Â Â if (session && session.id_token) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const payload = JSON.parse(atob(session.id_token.split('.')[1]));
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const displayName = payload.given_name || payload.email || 'User';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â email: payload.email,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sub: payload.sub,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â displayName: displayName
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } catch (e) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â console.error('Error parsing token:', e);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â return null;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â async function signin(){
Â Â Â Â Â Â Â Â Â Â Â Â const verifier = genRandom();
Â Â Â Â Â Â Â Â Â Â Â Â localStorage.setItem('pkce_verifier', verifier);
Â Â Â Â Â Â Â Â Â Â Â Â const challenge = await sha256(verifier);
Â Â Â Â Â Â Â Â Â Â Â Â const url =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â https://${cognitoConfig.domain}/oauth2/authorize?response_type=code
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &client_id=${cognitoConfig.clientId}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &redirect_uri=${encodeURIComponent(cognitoConfig.redirectUri)}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &scope=email+openid+profile
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &code_challenge_method=S256
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &code_challenge=${challenge};
Â Â Â Â Â Â Â Â Â Â Â Â window.location.href = url;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â function signout(){
Â Â Â Â Â Â Â Â Â Â Â Â clearSession();
Â Â Â Â Â Â Â Â Â Â Â Â window.location.href =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â https://${cognitoConfig.domain}/logout?client_id=${cognitoConfig.clientId}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &logout_uri=${encodeURIComponent(window.location.origin)};
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â async function handleCodeExchange(){
Â Â Â Â Â Â Â Â Â Â Â Â const params = new URLSearchParams(window.location.search);
Â Â Â Â Â Â Â Â Â Â Â Â const code = params.get('code');
Â Â Â Â Â Â Â Â Â Â Â Â if(!code) return false;
Â Â Â Â Â Â Â Â Â Â Â Â const verifier = localStorage.getItem('pkce_verifier');
Â Â Â Â Â Â Â Â Â Â Â Â if (!verifier) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â window.history.replaceState({},document.title,cognitoConfig.redirectUri);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return false;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â // ... [Exchange logic remains the same]
Â Â Â Â Â Â Â Â Â Â Â Â const body =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â grant_type=authorization_code
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &client_id=${cognitoConfig.clientId}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &code=${code}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &redirect_uri=${encodeURIComponent(cognitoConfig.redirectUri)}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â + &code_verifier=${verifier};
Â Â Â Â Â Â Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const res = await fetch(cognitoConfig.tokenEndpoint,{
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â method:'POST',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â headers:{'Content-Type':'application/x-www-form-urlencoded'},
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â body
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const tokens = await res.json();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if(res.ok && tokens.id_token) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â saveSession(tokens);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â localStorage.removeItem('pkce_verifier');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â window.history.replaceState({},document.title,cognitoConfig.redirectUri);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return true;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return false;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â } catch (error) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return false;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â function setupTokenRefresh() {
Â Â Â Â Â Â Â Â Â Â Â Â setInterval(async () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const session = getSession();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (session && isTokenExpired(session.id_token)) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â await refreshSession();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â window.app.checkAuthAndUpdateUI();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â }, 30000);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â async function initializeAuth() {
Â Â Â Â Â Â Â Â Â Â Â Â await handleCodeExchange();
Â Â Â Â Â Â Â Â Â Â Â Â const actualAuthStatus = await isAuthenticated();
Â Â Â Â Â Â Â Â Â Â Â Â window.app.checkAuthAndUpdateUI();
Â Â Â Â Â Â Â Â Â Â Â Â setupTokenRefresh();
Â Â Â Â Â Â Â Â Â Â Â Â return actualAuthStatus;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â // --- CORE APPLICATION MANAGERS ---
Â Â Â Â Â Â Â Â class CartManager {
Â Â Â Â Â Â Â Â Â Â Â Â constructor() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.cartKey = 'shoppingCart';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.loadCart();
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â loadCart() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const cart = localStorage.getItem(this.cartKey);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.items = cart ? JSON.parse(cart) : [];
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â saveCart() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â localStorage.setItem(this.cartKey, JSON.stringify(this.items));
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â getCartItems() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return this.items;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â getCartTotalItems() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return this.items.length;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â isInCart(productId) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return this.items.some(item => item.id === productId);
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â addItem(product) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (this.isInCart(product.id)) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â console.log(Product ${product.id} already in cart.);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return false;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Product is unique, add it (quantity is implicitly 1 for unique custom items)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.items.push(product);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.saveCart();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â console.log(Added product ${product.id} to cart.);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return true;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â removeItem(productId) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const initialLength = this.items.length;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.items = this.items.filter(item => item.id !== productId);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.saveCart();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return this.items.length < initialLength;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â clearCart() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.items = [];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.saveCart();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â console.log('Cart cleared.');
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â class ProductManager {
Â Â Â Â Â Â Â Â Â Â Â Â constructor(cartManager) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.cartManager = cartManager;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.productDataKey = 'userMockupProducts';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.loadMockupProducts();
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â loadMockupProducts() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const products = localStorage.getItem(this.productDataKey);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Mock products structure: [{ id: 'unique-id', name: 'Design X', device: 'iPhone 15', price: 34.99, images: ['url1', 'url2', 'url3', 'url4'] }]
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.mockupProducts = products ? JSON.parse(products) : [];
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â saveMockupProducts() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â localStorage.setItem(this.productDataKey, JSON.stringify(this.mockupProducts));
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â // Simulates server-side generation based on user input
Â Â Â Â Â Â Â Â Â Â Â Â simulateGenerateMockups(device, fileNames) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const baseId = crypto.randomUUID();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const designs = ['Rose Petal Bloom', 'Midnight Lily Mix'];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.mockupProducts = designs.map((design, index) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const productId = ${baseId}-${index};
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â id: productId,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â name: ${design},
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â device: device,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â price: 34.99 + (index * 5), // Vary price
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â images: [
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â https://placehold.co/150x250/f9fafb/374151?text=Front,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â https://placehold.co/150x250/f0fdf4/16a34a?text=Back,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â https://placehold.co/150x250/f0f9ff/06b6d4?text=Side,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â https://placehold.co/150x250/fff7ed/f97316?text=Room+Mockup
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ],
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Store metadata about source files for fulfillment
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sourceImages: fileNames
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.saveMockupProducts();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return this.mockupProducts;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â // Retrieves the HTML for the product list
Â Â Â Â Â Â Â Â Â Â Â Â getProductsHtml() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (this.mockupProducts.length === 0) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<p class="text-center text-gray-500 py-10">No custom designs found. <span class="text-rose-500 cursor-pointer" onclick="window.app.setPath('case-studio')">Start designing now!</span></p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${this.mockupProducts.map(product => { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const inCart = this.cartManager.isInCart(product.id); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this.renderProductCard(product, inCart); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).join('')} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â // Reusable component for a single product card
Â Â Â Â Â Â Â Â Â Â Â Â renderProductCard(product, inCart) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const buttonColor = inCart ? 'bg-gray-500 hover:bg-gray-600' : 'bg-rose-500 hover:bg-rose-600';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const buttonText = inCart ? 'Remove from Cart' : 'Add to Cart';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const buttonAction = inCart ? window.app.cartManager.removeItem('${product.id}'); window.app.productManager.renderProductList() : window.app.cartManager.addItem(${JSON.stringify(product).replace(/"/g, '&quot;')}); window.app.productManager.renderProductList();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return `
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div id="product-card-${product.id}" class="bg-white p-4 border border-gray-100 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col items-center">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <h3 class="text-xl font-semibold text-gray-800 mb-2">${product.name}</h3>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <p class="text-sm text-gray-500 mb-4">Device: ${product.device}</p>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <!-- Mockup Image Preview -->
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <div class="w-full h-64 bg-gray-100 rounded-lg overflow-hidden mb-4 relative">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <img src="$$ {product.images[0]}" alt=" $${product.name} Front Mockup" class="w-full h-full object-cover">
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="absolute top-2 right-2 px-3 py-1 bg-rose-500 text-white text-xs font-bold rounded-full">$$  {product.price.toFixed(2)}</span>
                        </div>
<button
onclick="${buttonAction}"
class="product-button w-full py-2 text-white font-medium ${buttonColor}"

${buttonText}
</button>
                    </div>
                `;
            }
// Re-renders the product list dynamically (used after adding/removing from cart)
renderProductList() {
const target = document.getElementById('product-mockups');
if (target) {
target.innerHTML = this.getProductsHtml();
// Also update cart count in navigation
window.app.renderNavigation();
}
}
clearMockups() {
this.mockupProducts = [];
this.saveMockupProducts();
}
}
// --- APPLICATION CONTROLLER & ROUTER ---
class Application {
constructor() {
this.state = {
isAuthenticated: false,
path: 'home', // 'home', 'case-studio', 'cart'
};
// Initialize managers here
this.cartManager = new CartManager();
this.productManager = new ProductManager(this.cartManager);
// Expose core methods to global scope
window.app = {
...this,
signin: signin,
signout: signout,
setPath: this.setPath.bind(this)
};
}
async initialize() {
// Initial auth check and refresh handling
const authStatus = await initializeAuth();
this.state.isAuthenticated = authStatus;
// Determine initial path based on URL hash or default
this.setPath(window.location.hash.substring(1) || 'home', false);
}
setPath(newPath, updateHistory = true) {
if (newPath === this.state.path) return;
// Protected routes
if (!this.state.isAuthenticated && (newPath === 'case-studio' || newPath === 'cart')) {
newPath = 'home';
}
this.state.path = newPath;
if (updateHistory) {
window.location.hash = newPath;
}
this.renderApp();
}
checkAuthAndUpdateUI() {
const userInfo = getUserInfo();
const isAuthenticated = !!userInfo;
this.state.isAuthenticated = isAuthenticated;
// Re-render core components
this.renderAuthUI();
this.renderNavigation();
this.showSessionInfo(userInfo);
// Reroute if authentication status changes and user is on a protected route
if (!isAuthenticated && (this.state.path === 'case-studio' || this.state.path === 'cart')) {
this.setPath('home', false);
} else {
this.renderApp(); // Re-render current view if necessary
}
}
// --- UI RENDERERS ---
renderAuthUI() {
const authDiv = document.getElementById('auth-action');
if (!authDiv) return;
const userInfo = getUserInfo();
if (userInfo) {
authDiv.innerHTML = `
                        <div class="flex items-center gap-4">
                            <span class="text-sm font-medium text-gray-700 hidden md:inline">Hello, ${userInfo.displayName}</span>
                            <button onclick="window.app.signout()" class="px-3 py-1 bg-red-400 text-white text-sm rounded-lg shadow-md hover:bg-red-500 auth-button">Sign Out</button>
                        </div>
                    `;
                } else {
                    authDiv.innerHTML = `
                        <button onclick="window.app.signin()" class="px-4 py-2 bg-rose-500 text-white font-semibold rounded-lg shadow-lg hover:bg-rose-600 auth-button">Sign In / Sign Up</button>
                    `;
                }
            }
renderNavigation() {
const navContainer = document.getElementById('nav-container');
if (!navContainer) return;
const authenticated = this.state.isAuthenticated;
const path = this.state.path;
const cartCount = this.cartManager.getCartTotalItems();
const navItem = (p, text, requiresAuth = false) => {
const active = p === path ? 'bg-rose-100 text-rose-700 font-bold' : 'text-gray-600 hover:bg-gray-100';
const authClass = requiresAuth && !authenticated ? 'opacity-50 cursor-not-allowed' : '';
const action = requiresAuth && !authenticated ? '' : onclick="window.app.setPath('${p}')";
return <button ${action} class="nav-button px-4 py-2 text-sm ${active} ${authClass}">${text}</button>;
};
navContainer.innerHTML = `
                    <div class="flex flex-wrap gap-2 p-3 bg-gray-50 rounded-lg shadow-inner justify-center">
                        ${navItem('home', 'Home')}
                        ${navItem('case-studio', 'Create Your Case', true)}
                        ${navItem('cart', `Cart (${cartCount})`, true)}
                        <div class="flex-grow"></div>
                        <div class="w-full md:w-auto p-2">
                             <input type="text" id="promo-code-input" placeholder="Promo Code (E.g. BLOOM20)" class="input-style bg-white text-sm w-full md:w-auto" onchange="window.app.applyPromo(this.value)">
                        </div>
                    </div>
                `;
            }
showSessionInfo(userInfo) {
const tokenDiv = document.getElementById('token-display');
if (userInfo) {
tokenDiv.classList.remove('bg-gray-50');
tokenDiv.classList.add('bg-green-50');
tokenDiv.innerHTML = <span class="text-green-700">âœ… Session Active for ${userInfo.displayName}.</span>;
} else {
tokenDiv.classList.remove('bg-green-50');
tokenDiv.classList.add('bg-gray-50');
tokenDiv.innerHTML = <span class="text-gray-500">âŒ Session inactive. Please sign in.</span>;
}
}
renderApp() {
const appContent = document.getElementById('app-content');
const authRequired = document.getElementById('auth-required-message');
if (this.state.isAuthenticated) {
authRequired.style.display = 'none';
appContent.style.display = 'block';
// Route to correct view
switch(this.state.path) {
case 'case-studio':
appContent.innerHTML = this.renderCaseStudioView();
// Re-initialize state-specific logic
document.getElementById('mockup-results').innerHTML = this.productManager.getProductsHtml();
break;
case 'cart':
appContent.innerHTML = this.renderCartView();
break;
case 'home':
default:
appContent.innerHTML = this.renderHomeView();
break;
}
} else {
appContent.style.display = 'none';
authRequired.style.display = 'block';
}
// Ensure navigation/auth reflects current state
this.renderAuthUI();
this.renderNavigation();
}
// --- VIEW TEMPLATES ---
renderHomeView() {
return `
                    <div class="app-view text-center py-16">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Welcome to FlowerBloom Custom Cases</h2>
                        <p class="text-xl text-rose-600 mb-6">Artistic flower collage & person image mix, designed for you.</p>
                        <p class="text-gray-600 max-w-2xl mx-auto mb-8">Create a unique, personalized phone case by uploading three imagesâ€”a portrait and two floral images. Our AI-driven design studio merges them into an elegant, custom piece tailored for the modern woman.</p>
                        <button onclick="window.app.setPath('case-studio')" class="px-8 py-3 bg-indigo-500 text-white text-lg font-semibold rounded-lg shadow-lg hover:bg-indigo-600 auth-button">
                            Start Designing Now!
                        </button>
                        <div id="promo-display" class="mt-8 p-4 bg-yellow-50 text-yellow-800 rounded-lg hidden">
                            <!-- Promo status updates here -->
                        </div>
                    </div>
                `;
            }
renderCaseStudioView() {
const devices = ['iPhone 15 Pro Max', 'iPhone 15', 'Samsung Galaxy S24 Ultra', 'Google Pixel 8'];
return `
                    <div class="app-view">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Custom Case Studio</h2>
                        <!-- STEP 1: Device Selection & Acknowledgement -->
                        <div id="upload-step-1" class="p-6 bg-rose-50 rounded-xl shadow-inner mb-8">
                            <h3 class="text-2xl font-semibold mb-4 text-rose-700">1. Select Device & Confirm</h3>
<label for="device-select" class="block text-gray-700 font-medium mb-2">Select Your Phone Model (for order fulfillment):</label>
<select id="device-select" class="input-style mb-4">
${devices.map(d => <option value="${d}">${d}</option>).join('')}
</select>
                            <div class="flex items-start mb-6">
                                <input type="checkbox" id="acknowledgement-check" class="w-4 h-4 text-rose-600 bg-gray-100 border-gray-300 rounded focus:ring-rose-500 mt-1">
                                <label for="acknowledgement-check" class="ml-2 text-sm text-gray-600 cursor-pointer">
                                    I acknowledge that the design mockup will be based on a generic device shape for viewing, but my actual order will be fulfilled for the selected device model.
                                </label>
                            </div>
                            <button id="proceed-upload-btn" onclick="window.app.toggleUploadStep2(true)" class="px-6 py-2 bg-gray-400 text-white font-medium rounded-lg shadow cursor-not-allowed" disabled>
                                Proceed to Image Upload
                            </button>
                        </div>
                        <!-- STEP 2: Image Upload & Generation -->
                        <div id="upload-step-2" class="p-6 bg-white border border-gray-200 rounded-xl shadow-lg" style="display: none;">
                            <h3 class="text-2xl font-semibold mb-4 text-gray-700">2. Upload Images & Generate Design</h3>
                            <p class="text-sm text-gray-500 mb-4">Upload exactly 3 images: 1 Portrait and 2 Floral/Artistic backgrounds.</p>
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <input type="file" id="image1" accept="image/*" class="col-span-1 border p-2 rounded-md">
                                <input type="file" id="image2" accept="image/*" class="col-span-1 border p-2 rounded-md">
                                <input type="file" id="image3" accept="image/*" class="col-span-1 border p-2 rounded-md">
                            </div>
                            <button onclick="window.app.startMockupGeneration()" class="px-6 py-3 bg-rose-500 text-white font-medium rounded-lg shadow-lg hover:bg-rose-600 product-button" id="generate-btn">
                                Generate Mockups (Simulated)
                            </button>
                            <div id="generation-progress" class="mt-4 text-sm text-indigo-600 font-medium hidden">
                                <p>Processing images on server...</p>
                                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                                    <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <!-- STEP 3: Generated Products -->
                        <div id="product-mockup-section" class="mt-8">
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">3. Your Custom Designs</h3>
                            <div id="product-mockups">
                                <!-- Products render here via ProductManager.renderProductList() -->
                            </div>
                        </div>
                    </div>
                `;
            }
renderCartView() {
const items = this.cartManager.getCartItems();
const subtotal = items.reduce((sum, item) => sum + item.price, 0);
const discount = (localStorage.getItem('activePromoDiscount') || 0) * subtotal;
const total = subtotal - discount;
return `
                    <div class="app-view">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Your Shopping Cart</h2>
                        <div class="flex flex-col lg:flex-row gap-8">
                            <!-- Cart Items -->
                            <div class="lg:w-2/3">
                                ${items.length === 0 ? `
                                    <div class="text-center p-10 bg-gray-50 rounded-lg text-gray-500">Your cart is empty.</div>
                                ` : items.map(item => `
                                    <div class="flex items-center justify-between p-4 mb-4 bg-white rounded-xl shadow border border-gray-100">
                                        <img src="\( {item.images[0]}" class="w-16 h-16 object-cover rounded-md mr-4 border border-rose-200" alt=" \){item.name}">
                                        <div class="flex-grow">
                                            <p class="font-semibold text-gray-800">${item.name}</p>
                                            <p class="text-sm text-gray-500">${item.device}</p>
                                        </div>
                                        <div class="text-lg font-bold text-rose-600 mr-8">  $${item.price.toFixed(2)}</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button onclick="window.app.cartManager.removeItem('${item.id}'); window.app.setPath('cart')" class="text-red-500 hover:text-red-700 p-2">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`).join('')}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<!-- Cart Summary -->
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="lg:w-1/3 p-6 bg-rose-50 rounded-xl shadow-lg h-min">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<h3 class="text-2xl font-bold mb-4 text-gray-800">Order Summary</h3>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="space-y-2 text-gray-600">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="flex justify-between"><span>Subtotal (${items.length} items):</span> <span>$$  {subtotal.toFixed(2)}</span></div>
                                    <div class="flex justify-between text-green-600"><span>Discount:</span> <span>-  $${discount.toFixed(2)}</span></div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<div class="pt-4 border-t border-rose-200 flex justify-between font-bold text-xl text-rose-700"><span>Total:</span> <span>$$  {total.toFixed(2)}</span></div>
                                </div>
                                <button onclick="alert('Checkout (Simulated): Proceeding with payment of   $${total.toFixed(2)}') ; window.app.cartManager.clearCart(); window.app.setPath('home');" ${items.length === 0 ? 'disabled' : ''} class="w-full mt-6 py-3 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 product-button ${items.length === 0 ? 'opacity-50 cursor-not-allowed' : ''}">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Proceed to Checkout
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<p class="text-xs text-center text-gray-400 mt-2">Final pricing and tax calculated at external payment processor.</p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
Â Â Â Â Â Â Â Â Â Â Â Â // --- STUDIO LOGIC ---
Â Â Â Â Â Â Â Â Â Â Â Â toggleUploadStep2(enable) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const ack = document.getElementById('acknowledgement-check');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const btn = document.getElementById('proceed-upload-btn');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (ack && btn) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â btn.disabled = !ack.checked;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â btn.classList.toggle('bg-gray-400', !ack.checked);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â btn.classList.toggle('cursor-not-allowed', !ack.checked);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â btn.classList.toggle('bg-indigo-500', ack.checked);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â btn.classList.toggle('hover:bg-indigo-600', ack.checked);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (ack.checked && enable) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById('upload-step-2').style.display = 'block';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } else if (enable) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById('upload-step-2').style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â startMockupGeneration() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const ack = document.getElementById('acknowledgement-check');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const deviceSelect = document.getElementById('device-select');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const files = [
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById('image1').files[0],
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById('image2').files[0],
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â document.getElementById('image3').files[0]
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (!ack.checked || files.filter(f => f).length !== 3) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â alert('Please select a device, acknowledge the terms, and upload exactly 3 images.');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const progressDiv = document.getElementById('generation-progress');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const progressBar = document.getElementById('progress-bar');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const generateBtn = document.getElementById('generate-btn');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const targetDevice = deviceSelect.value;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const fileNames = files.map(f => f.name);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â generateBtn.disabled = true;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â generateBtn.textContent = 'Generating...';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â progressDiv.style.display = 'block';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â progressBar.style.width = '0%';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â let step = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const totalSteps = 4;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const interval = setInterval(() => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â step++;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const progress = (step / totalSteps) * 100;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â progressBar.style.width = ${progress}%;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (step === 1) console.log('Simulating: Step 1 (Image Upload & Validation) complete...');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (step === 2) console.log('Simulating: Step 2 (AI Flower Collage Creation) complete...');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (step === 3) console.log('Simulating: Step 3 (Person-Image Masking/Mix) complete...');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (step >= totalSteps) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â clearInterval(interval);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Final step: Generate mockups and render
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.productManager.simulateGenerateMockups(targetDevice, fileNames);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.productManager.renderProductList();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â progressDiv.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â generateBtn.disabled = false;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â generateBtn.textContent = 'Generate Mockups (Simulated)';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â console.log('Mockup Generation Complete.');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }, 1500); // 1.5 seconds per step simulation
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â applyPromo(code) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â const promoDiv = document.getElementById('promo-display');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (promoDiv) promoDiv.style.display = 'block';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â let discount = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â let message = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Simulated server-side validation
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (code.toUpperCase() === 'BLOOM20') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â discount = 0.20; // 20% discount
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â message = ğŸ‰ Success! Promo code BLOOM20 applied. Enjoy 20% off your total!;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } else if (code.toUpperCase() === 'FREECASE') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â discount = 1.00; // Mock 100% for one item
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â message = âœ¨ Success! FREECASE code applied. Free item status confirmed.;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } else if (code.length > 0) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â discount = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â message = âŒ Invalid promo code: ${code}. Please try again.;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â localStorage.removeItem('activePromoDiscount');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (promoDiv) promoDiv.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.renderApp(); // Re-render cart if on cart page
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â localStorage.setItem('activePromoDiscount', discount);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if (promoDiv) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â promoDiv.innerHTML = message;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Re-render current view to reflect changes (especially if on Cart page)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â this.renderApp();
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â // --- GLOBAL INITIALIZATION ---
Â Â Â Â Â Â Â Â // Register event listener for the acknowledgement checkbox
Â Â Â Â Â Â Â Â document.addEventListener('change', (e) => {
Â Â Â Â Â Â Â Â Â Â Â Â if (e.target.id === 'acknowledgement-check') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â window.app.toggleUploadStep2(false);
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â // Initialize application when DOM is loaded
Â Â Â Â Â Â Â Â document.addEventListener('DOMContentLoaded', async () => {
Â Â Â Â Â Â Â Â Â Â Â Â // Mock window.stripePayment for the app logic
Â Â Â Â Â Â Â Â Â Â Â Â window.stripePayment = { loadCart: () => console.log("Stripe cart loaded (simulated).") };
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â // Initialize the main application controller
Â Â Â Â Â Â Â Â Â Â Â Â const appInstance = new Application();
Â Â Â Â Â Â Â Â Â Â Â Â await appInstance.initialize();
Â Â Â Â Â Â Â Â });
Â Â Â Â </script>
</body>
</html>
