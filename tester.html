<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cognito Auth Tester (PKCE)</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
.container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
h1,h2,h3 { color:#333; }
#auth-action { margin-bottom: 20px; }
#auth-action button { padding:10px 20px; font-size:16px; background-color:#f90; color:white; border:none; border-radius:5px; cursor:pointer; }
#token-display pre { background:#eee; padding:10px; border-radius:4px; overflow-x:auto; }
#token-display textarea { width:100%; height:100px; padding:10px; box-sizing:border-box; border:1px solid #ccc; border-radius:4px; resize:none; font-family:monospace; }
#uploadSection { margin-top:20px; }
#uploadSection input { margin-bottom:10px; }
#uploadSection button { padding:10px 20px; font-size:16px; background-color:#28a745; color:white; border:none; border-radius:5px; cursor:pointer; }
#uploadResult { margin-top:10px; font-weight:bold; }

/* Device selection styles */
.device-selection { margin: 20px 0; }
.brand-selection { margin-bottom: 15px; }
.brand-option { margin-right: 15px; }
.acknowledge-section {Â 
Â  Â  margin: 15px 0;Â 
Â  Â  padding: 10px;Â 
Â  Â  background-color: #fff9e6;Â 
Â  Â  border: 1px solid #ffd166;
Â  Â  border-radius: 5px;
Â  Â  display: none;
}
.acknowledge-section p { margin: 0 0 10px 0; font-size: 14px; }
.acknowledge-section label { display: flex; align-items: flex-start; }
.acknowledge-section input { margin-right: 8px; margin-top: 2px; }

/* Loading states */
.loading { opacity: 0.6; pointer-events: none; }
.loading::after { content: ' (Loading...)'; font-style: italic; }

/* Notification styles */
.notification {
Â  Â  padding: 10px;
Â  Â  margin: 10px 0;
Â  Â  border-radius: 4px;
Â  Â  display: none;
}
.notification.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.notification.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.notification.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
</style>
</head>
<body>

<div class="container">
Â  Â  <h1>AWS Cognito Authentication Status</h1>
Â  Â  <div id="auth-action"></div>

Â  Â  <div id="notification" class="notification"></div>

Â  Â  <div id="token-display"><h2>Not signed in</h2></div>
Â  Â Â 
Â  Â  <div class="device-selection">
Â  Â  Â  Â  <h2>Select Your Device</h2>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="brand-selection">
Â  Â  Â  Â  Â  Â  <label class="brand-option">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="radio" name="brand" value="apple" checked> Apple
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  <label class="brand-option">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="radio" name="brand" value="samsung"> Samsung
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <label for="deviceSelect">Model:</label>
Â  Â  Â  Â  <select id="deviceSelect">
Â  Â  Â  Â  Â  Â  <option value="">-- Choose Model --</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="acknowledge-section" id="acknowledgeSection">
Â  Â  Â  Â  Â  Â  <p style="margin: 0 0 10px 0; font-size: 14px;">
Â  Â  Â  Â  Â  Â  Â  Â  <strong>Important:</strong> For demonstration, we'll show your design on <span id="demoDevice">iPhone 16 Pro Max</span>.Â 
Â  Â  Â  Â  Â  Â  Â  Â  Your actual order will be custom-made specifically for your selected device: <strong id="selectedDevice"></strong>.
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="acknowledgeCheckbox"> I understand my case and wallpaper will be custom-made for: <strong id="deviceName"></strong>
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="uploadSection" style="display:none;">
Â  Â  Â  Â  <h2>Upload 3 Images</h2>
Â  Â  Â  Â  <input type="file" id="fileInput" multiple accept="image/*">
Â  Â  Â  Â  <br>
Â  Â  Â  Â  <button onclick="uploadFiles()">Upload</button>
Â  Â  Â  Â  <div id="uploadResult"></div>
Â  Â  </div>
</div>

<script>
const devices = {
Â  Â  apple: [
Â  Â  Â  Â  { name: "iPhone 17", value: "iphone17" },
Â  Â  Â  Â  { name: "iPhone Air", value: "iphoneair" },
Â  Â  Â  Â  { name: "iPhone 17 Pro", value: "iphone17pro" },
Â  Â  Â  Â  { name: "iPhone 17 Pro Max", value: "iphone17promax" },
Â  Â  Â  Â  { name: "iPhone 16", value: "iphone16" },
Â  Â  Â  Â  { name: "iPhone 16e", value: "iphone16e" },
Â  Â  Â  Â  { name: "iPhone 16 Plus", value: "iphone16plus" },
Â  Â  Â  Â  { name: "iPhone 16 Pro", value: "iphone16pro" },
Â  Â  Â  Â  { name: "iPhone 16 Pro Max", value: "iphone16promax" },
Â  Â  Â  Â  { name: "iPhone 14", value: "iphone14" },
Â  Â  Â  Â  { name: "iPhone 14 Plus", value: "iphone14plus" },
Â  Â  Â  Â  { name: "iPhone 14 Pro", value: "iphone14pro" },
Â  Â  Â  Â  { name: "iPhone 14 Pro Max", value: "iphone14promax" }
Â  Â  ],
Â  Â  samsung: [
Â  Â  Â  Â  { name: "Galaxy S25", value: "samsungs25" },
Â  Â  Â  Â  { name: "Galaxy S25+", value: "samsungs25plus" },
Â  Â  Â  Â  { name: "Galaxy S25 Ultra", value: "samsungs25ultra" },
Â  Â  Â  Â  { name: "Galaxy S24", value: "samsungs24" },
Â  Â  Â  Â  { name: "Galaxy S24+", value: "samsungs24plus" },
Â  Â  Â  Â  { name: "Galaxy S24 Ultra", value: "samsungs24ultra" },
Â  Â  Â  Â  { name: "Galaxy S23", value: "samsungs23" },
Â  Â  Â  Â  { name: "Galaxy S23+", value: "samsungs23plus" },
Â  Â  Â  Â  { name: "Galaxy S22", value: "samsungs22" },
Â  Â  Â  Â  { name: "Galaxy S21", value: "samsungs21" }
Â  Â  ]
};

// --- PKCE UTILITY FUNCTIONS ---
function base64urlencode(buffer){
Â  Â  // If buffer is an ArrayBuffer (from crypto.subtle.digest), convert to string
    const bytes = new Uint8Array(buffer);
Â  Â  let binary = '';
Â  Â  for (let i = 0; i < bytes.byteLength; i++) {
Â  Â  Â  Â  binary += String.fromCharCode(bytes[i]);
Â  Â  }
Â  Â  return btoa(binary)
Â  Â  Â  Â  .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
}
async function sha256(str){
Â  Â  const digest = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
Â  Â  return base64urlencode(digest);
}
function genRandom(){Â 
Â  Â  const arr = new Uint8Array(32);Â 
Â  Â  crypto.getRandomValues(arr);Â 
Â  Â  // When converting Uint8Array to string for base64urlencode, pass the array itself
    // and let the function handle the conversion
    return base64urlencode(arr); 
}

// --- CONFIG & SESSION MANAGEMENT ---
const cognitoConfig = {
Â  Â  clientId: '73lf1h32phkqeb9ahu6tqcl9av',
Â  Â  domain: 'auth.theweer.com',
Â  Â  redirectUri: window.location.origin + window.location.pathname,
Â  Â  tokenEndpoint: `https://auth.theweer.com/oauth2/token`
};

function saveSession(t){ localStorage.setItem('cognitoSession', JSON.stringify(t)); }
function getSession(){ return JSON.parse(localStorage.getItem('cognitoSession')); }

// Notification system
function showNotification(message, type = 'info') {
Â  Â  const notification = document.getElementById('notification');
Â  Â  notification.textContent = message;
Â  Â  notification.className = `notification ${type}`;
Â  Â  notification.style.display = 'block';
Â  Â Â 
Â  Â  setTimeout(() => {
Â  Â  Â  Â  notification.style.display = 'none';
Â  Â  }, 5000);
}

// Enhanced error handling
function handleApiError(error, context = 'operation') {
Â  Â  console.error(`Error in ${context}:`, error);
Â  Â  showNotification(`Failed to complete ${context}. Please try again.`, 'error');
}

// Loading state management
function setLoadingState(elementId, isLoading) {
Â  Â  const element = document.getElementById(elementId);
Â  Â  if (!element) return;
Â  Â Â 
Â  Â  if (isLoading) {
Â  Â  Â  Â  element.disabled = true;
Â  Â  Â  Â  element.classList.add('loading');
Â  Â  } else {
Â  Â  Â  Â  element.disabled = false;
Â  Â  Â  Â  element.classList.remove('loading');
Â  Â  }
}


// --- AUTH FLOW FUNCTIONS (PKCE) ---

function showAuthUI(){
Â  Â  document.getElementById('auth-action').innerHTML = `
Â  Â  Â  Â  <button onclick="signin()">Sign In / Sign Up</button>
Â  Â  Â  Â  <button onclick="signout()">Sign Out</button>
Â  Â  `;
}

async function signin(){
Â  Â  const verifier = genRandom();
Â  Â  localStorage.setItem('pkce_verifier', verifier);
Â  Â  const challenge = await sha256(verifier);
Â  Â  const url =
Â  Â  Â  `https://${cognitoConfig.domain}/oauth2/authorize?response_type=code`
Â  Â  Â  + `&client_id=${cognitoConfig.clientId}`
Â  Â  Â  + `&redirect_uri=${encodeURIComponent(cognitoConfig.redirectUri)}`
Â  Â  Â  + `&scope=email+openid+profile`
Â  Â  Â  + `&code_challenge_method=S256`
Â  Â  Â  + `&code_challenge=${challenge}`;
Â  Â  window.location.href = url;
}

function signout(){
Â  Â  localStorage.removeItem('cognitoSession');
    localStorage.removeItem('pkce_verifier');
Â  Â  window.location.href =
Â  Â  Â  `https://${cognitoConfig.domain}/logout?client_id=${cognitoConfig.clientId}`
Â  Â  Â  + `&logout_uri=${encodeURIComponent(window.location.origin)}`;
}

async function handleCodeExchange(){
Â  Â  const params = new URLSearchParams(window.location.search);
Â  Â  const code = params.get('code');
Â  Â  if(!code) return;

Â  Â  const verifier = localStorage.getItem('pkce_verifier');
Â  Â  if (!verifier) {
        console.error("PKCE Error: Code verifier not found in storage.");
        return;
    }

Â  Â  const body =
Â  Â  Â  `grant_type=authorization_code`
Â  Â  Â  + `&client_id=${cognitoConfig.clientId}`
Â  Â  Â  + `&code=${code}`
Â  Â  Â  + `&redirect_uri=${encodeURIComponent(cognitoConfig.redirectUri)}`
Â  Â  Â  + `&code_verifier=${verifier}`;

Â  Â  try {
Â  Â  Â  Â  const res = await fetch(cognitoConfig.tokenEndpoint,{
Â  Â  Â  Â  Â  Â  method:'POST',
Â  Â  Â  Â  Â  Â  headers:{'Content-Type':'application/x-www-form-urlencoded'},
Â  Â  Â  Â  Â  Â  body
Â  Â  Â  Â  });
Â  Â  Â  Â  const tokens = await res.json();

Â  Â  Â  Â  if(res.ok && tokens.id_token) {
Â  Â  Â  Â  Â  Â  saveSession(tokens);
            localStorage.removeItem('pkce_verifier'); // Clear verifier after successful use
Â  Â  Â  Â  Â  Â  showNotification('Successfully signed in!', 'success');
Â  Â  Â  Â  } else {
            throw new Error(tokens.error_description || "Token exchange failed.");
        }
Â  Â  Â  Â  // Clean the URL after exchange regardless of success
Â  Â  Â  Â  window.history.replaceState({},document.title,cognitoConfig.redirectUri);
Â  Â  } catch (error) {
Â  Â  Â  Â  handleApiError(error, 'authentication');
Â  Â  }
}

function showSessionInfo(){
Â  Â  const s = getSession();
Â  Â  const div = document.getElementById('token-display');
Â  Â  if(s?.id_token){
Â  Â  Â  Â  const payload = JSON.parse(atob(s.id_token.split('.')[1]));
Â  Â  Â  Â  div.innerHTML = `<h2>Signed in as ${payload.email || payload.sub}</h2><pre>${JSON.stringify(payload,null,2)}</pre>`;
Â  Â  } else div.innerHTML = `<h2>Not signed in</h2>`;
}

// --- API CALL FUNCTIONS (USING ACCESS TOKEN) ---

async function updateCustomerDevice(deviceId) {
Â  Â  // IMPORTANT: Using access_token for API authorization
Â  Â  const token = getSession()?.access_token; 
Â  Â  if (!token) {
Â  Â  Â  Â  console.log('User not signed in, skipping device update');
Â  Â  Â  Â  return; 
Â  Â  }
Â  Â Â 
Â  Â  try {
Â  Â  Â  Â  console.log('ðŸš€ Calling Lambda to update device:', deviceId);
Â  Â  Â  Â  const response = await fetch('https://y4vn8tdr5g.execute-api.us-east-1.amazonaws.com/prod/upload', {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',Â 
Â  Â  Â  Â  Â  Â  Â  Â  'Authorization': token // <-- Access Token is used here
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  body: JSON.stringify({Â 
Â  Â  Â  Â  Â  Â  Â  Â  device_id: deviceId,
Â  Â  Â  Â  Â  Â  Â  Â  action: 'updateDevice'
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  console.log('ðŸ“¡ API Response status:', response.status);
Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  Â  console.log('âœ… Device updated successfully:', result);
Â  Â  Â  Â  Â  Â  showNotification('Device selection saved successfully', 'success');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const error = await response.text();
Â  Â  Â  Â  Â  Â  console.error('âŒ Failed to update device:', error);
Â  Â  Â  Â  Â  Â  showNotification('Failed to save device selection', 'error');
Â  Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('ðŸ’¥ Error updating device:', error);
Â  Â  Â  Â  showNotification('Network error saving device selection', 'error');
Â  Â  }
}


let selectedFiles = [];

// File validation
function validateFileSelection(files) {
Â  Â  if (files.length !== 3) {
Â  Â  Â  Â  return { valid: false, message: "Please select exactly 3 images" };
Â  Â  }
Â  Â Â 
Â  Â  const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
Â  Â  const invalidFiles = files.filter(f => !validTypes.includes(f.type));
Â  Â Â 
Â  Â  if (invalidFiles.length > 0) {
Â  Â  Â  Â  return { valid: false, message: "Please select valid image files (JPEG, PNG, GIF, WebP)" };
Â  Â  }
Â  Â Â 
Â  Â  // Check file sizes (5MB max)
Â  Â  const maxSize = 5 * 1024 * 1024;
Â  Â  const oversizedFiles = files.filter(f => f.size > maxSize);
Â  Â Â 
Â  Â  if (oversizedFiles.length > 0) {
Â  Â  Â  Â  return { valid: false, message: "Files must be smaller than 5MB" };
Â  Â  }
Â  Â Â 
Â  Â  return { valid: true };
}

async function uploadFiles() {
Â  Â  // IMPORTANT: Using access_token for API authorization
Â  Â  const token = getSession()?.access_token; 
Â  Â  const deviceId = document.getElementById('deviceSelect').value;

Â  Â  if (!token) return showNotification('Please sign in first', 'error');
Â  Â  if (!deviceId) return showNotification('Please select a device before uploading', 'error');
Â  Â Â 
Â  Â  const validation = validateFileSelection(selectedFiles);
Â  Â  if (!validation.valid) {
Â  Â  Â  Â  return showNotification(validation.message, 'error');
Â  Â  }

Â  Â  setLoadingState('uploadSection', true);
Â  Â  const resultDiv = document.getElementById('uploadResult');
Â  Â  resultDiv.innerHTML = 'Uploading files...';

Â  Â  const filesData = selectedFiles.map((f, i) => ({
Â  Â  Â  Â  fileId: i + 1,
Â  Â  Â  Â  fileName: f.name,
Â  Â  Â  Â  fileType: f.type
Â  Â  }));

Â  Â  try {
Â  Â  Â  Â  // Step 1: Get presigned URLs from Lambda
Â  Â  Â  Â  const res = await fetch('https://y4vn8tdr5g.execute-api.us-east-1.amazonaws.com/prod/upload', {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json', 'Authorization': token }, // <-- Access Token
Â  Â  Â  Â  Â  Â  body: JSON.stringify({ files: filesData, device_id: deviceId })
Â  Â  Â  Â  });

Â  Â  Â  Â  const data = await res.json();

Â  Â  Â  Â  if (!res.ok || !data.uploadUrls) {
Â  Â  Â  Â  Â  Â  throw new Error(data.error || JSON.stringify(data));
Â  Â  Â  Â  }

Â  Â  Â  Â  // Step 2: Upload files and notify Lambda
Â  Â  Â  Â  const uploadPromises = data.uploadUrls.map(async (u, idx) => {
Â  Â  Â  Â  Â  Â  const uploadResponse = await fetch(u.uploadUrl, {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'PUT',
Â  Â  Â  Â  Â  Â  Â  Â  body: selectedFiles[idx],
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': selectedFiles[idx].type }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (!uploadResponse.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Failed to upload ${selectedFiles[idx].name}`);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const notificationPayload = {
Â  Â  Â  Â  Â  Â  Â  Â  action: 'uploadComplete',
Â  Â  Â  Â  Â  Â  Â  Â  fileKey: u.key,
Â  Â  Â  Â  Â  Â  Â  Â  metadata: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileName: u.fileName,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  priority: u.priority,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  srcid: u.srcid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  palette_id: u.palette_id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flavor: u.flavor,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cid: data.cid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  device_id: deviceId
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  await fetch('https://y4vn8tdr5g.execute-api.us-east-1.amazonaws.com/prod/upload', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json', 'Authorization': token }, // <-- Access Token
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(notificationPayload)
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  await Promise.all(uploadPromises);
Â  Â  Â  Â  resultDiv.innerHTML = `âœ… All 3 files uploaded successfully! Processing started...`;
Â  Â  Â  Â  showNotification('Files uploaded successfully! Processing your images...', 'success');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Show the real-time panel for updates
Â  Â  Â  Â  if (window.realtimeUpdates) {
Â  Â  Â  Â  Â  Â  window.realtimeUpdates.showPanel();
Â  Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Upload error:', error);
Â  Â  Â  Â  resultDiv.innerHTML = `âŒ Error uploading files: ${error.message}`;
Â  Â  Â  Â  showNotification('Failed to upload files', 'error');
Â  Â  } finally {
Â  Â  Â  Â  setLoadingState('uploadSection', false);
Â  Â  }
}


// --- UI / INITIALIZATION LOGIC (Device Selection) ---

function initializeDeviceOptions() {
Â  Â  updateDeviceOptions();
Â  Â  const brandRadios = document.querySelectorAll('input[name="brand"]');
Â  Â  brandRadios.forEach(radio => { radio.addEventListener('change', updateDeviceOptions); });
Â  Â  const deviceSelect = document.getElementById('deviceSelect');
Â  Â  deviceSelect.addEventListener('change', showAcknowledgeSection);
Â  Â  const acknowledgeCheckbox = document.getElementById('acknowledgeCheckbox');
Â  Â  acknowledgeCheckbox.addEventListener('change', toggleUploadSection);
}

function updateDeviceOptions() {
Â  Â  const selectedBrand = document.querySelector('input[name="brand"]:checked').value;
Â  Â  const deviceSelect = document.getElementById('deviceSelect');
Â  Â  deviceSelect.innerHTML = '<option value="">-- Choose Model --</option>';
Â  Â  if (!selectedBrand || !devices[selectedBrand]) return;
Â  Â  devices[selectedBrand].forEach(d => {
Â  Â  Â  Â  const opt = document.createElement('option');
Â  Â  Â  Â  opt.value = d.value;
Â  Â  Â  Â  opt.textContent = d.name;
Â  Â  Â  Â  deviceSelect.appendChild(opt);
Â  Â  });
Â  Â  document.getElementById('acknowledgeSection').style.display = 'none';
Â  Â  document.getElementById('uploadSection').style.display = 'none';
Â  Â  document.getElementById('acknowledgeCheckbox').checked = false;
}

function showAcknowledgeSection() {
Â  Â  const deviceSelect = document.getElementById('deviceSelect');
Â  Â  const acknowledgeSection = document.getElementById('acknowledgeSection');
Â  Â Â 
Â  Â  if (deviceSelect.value) {
Â  Â  Â  Â  const selectedDevice = deviceSelect.options[deviceSelect.selectedIndex].text;
Â  Â  Â  Â  const deviceValue = deviceSelect.value;
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('selectedDevice').textContent = selectedDevice;
Â  Â  Â  Â  document.getElementById('deviceName').textContent = selectedDevice;
Â  Â  Â  Â  acknowledgeSection.style.display = 'block';
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Update customer device in database
Â  Â  Â  Â  console.log('ðŸ”„ Device selected, updating database...');
Â  Â  Â  Â  updateCustomerDevice(deviceValue);
Â  Â  } else {
Â  Â  Â  Â  acknowledgeSection.style.display = 'none';
Â  Â  Â  Â  document.getElementById('uploadSection').style.display = 'none';
Â  Â  }
}

function toggleUploadSection() {
Â  Â  const acknowledgeCheckbox = document.getElementById('acknowledgeCheckbox');
Â  Â  const uploadSection = document.getElementById('uploadSection');
Â  Â Â 
Â  Â  if (acknowledgeCheckbox.checked) {
Â  Â  Â  Â  uploadSection.style.display = 'block';
Â  Â  } else {
Â  Â  Â  Â  uploadSection.style.display = 'none';
Â  Â  }
}

// File Input Handler
document.getElementById('fileInput').addEventListener('change', (e)=>{
Â  Â  selectedFiles = Array.from(e.target.files);
Â  Â  const validation = validateFileSelection(selectedFiles);
Â  Â  if (!validation.valid) {
Â  Â  Â  Â  showNotification(validation.message, 'warning');
Â  Â  Â  Â  selectedFiles = [];
Â  Â  Â  Â  e.target.value = '';
Â  Â  }
});


// Initialize application
async function initializeApp() {
Â  Â  await handleCodeExchange();
Â  Â  showAuthUI();
Â  Â  showSessionInfo();
}

// Start the application
document.addEventListener('DOMContentLoaded', () => {
    initializeDeviceOptions();
    initializeApp();
});
</script>

<link rel="stylesheet" href="realtime-updates.css">
<script src="realtime-updates.js"></script>
</body>
</html>
