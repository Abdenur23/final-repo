<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cognito Auth - Working Version</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        .info { background: #e7f3ff; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Cognito Authentication</h1>
    
    <div class="info">
        <strong>Using Client:</strong> 7irso7dmmnp793egs9bhkl0t81 (Implicit Flow)<br>
        <strong>Response Type:</strong> token
    </div>
    
    <button onclick="signIn()">Sign In / Sign Up</button>
    
    <div id="userInfo" style="display: none; margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px;">
        <h3>âœ… Signed In Successfully!</h3>
        <p><strong>Email:</strong> <span id="userEmail"></span></p>
        <p><strong>User ID:</strong> <span id="userId"></span></p>
        <button onclick="signOut()">Sign Out</button>
    </div>

    <script>
        // Configuration that works (based on your working code)
        const config = {
            clientId: '7irso7dmmnp793egs9bhkl0t81', // Use the client that works
            redirectUri: 'https://theweer.com/tester.html',
            cognitoDomain: 'https://auth.theweer.com',
            scopes: 'email openid profile'
        };

        // Check for tokens in URL
        function checkAuthentication() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            
            const accessToken = params.get('access_token');
            const idToken = params.get('id_token');
            const error = params.get('error');
            
            if (error) {
                console.log('Auth error:', error, params.get('error_description'));
                return;
            }
            
            if (accessToken && idToken) {
                // Save tokens
                localStorage.setItem('cognito_access_token', accessToken);
                localStorage.setItem('cognito_id_token', idToken);
                
                // Show user info
                showUserInfo();
                
                // Clear URL
                window.location.hash = '';
            } else if (localStorage.getItem('cognito_id_token')) {
                // Already signed in
                showUserInfo();
            }
        }

        // Show user information
        function showUserInfo() {
            const idToken = localStorage.getItem('cognito_id_token');
            if (!idToken) return;
            
            try {
                const payload = JSON.parse(atob(idToken.split('.')[1]));
                
                document.getElementById('userEmail').textContent = payload.email || 'Not available';
                document.getElementById('userId').textContent = payload.sub || 'Not available';
                document.getElementById('userInfo').style.display = 'block';
            } catch (error) {
                console.error('Error parsing token:', error);
            }
        }

        // Sign in
        function signIn() {
            const authUrl = `${config.cognitoDomain}/oauth2/authorize?` + new URLSearchParams({
                client_id: config.clientId,
                response_type: 'token', // Use token (implicit flow)
                scope: config.scopes,
                redirect_uri: config.redirectUri
            });
            
            window.location.href = authUrl;
        }

        // Sign out
        function signOut() {
            localStorage.removeItem('cognito_access_token');
            localStorage.removeItem('cognito_id_token');
            document.getElementById('userInfo').style.display = 'none';
            
            // Optional: Redirect to logout
            const logoutUrl = `${config.cognitoDomain}/logout?` + new URLSearchParams({
                client_id: config.clientId,
                logout_uri: config.redirectUri
            });
            // window.location.href = logoutUrl;
        }

        // Initialize
        checkAuthentication();
    </script>
</body>
</html>
