<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Custom Phone Cases</title>
Â  <link rel="stylesheet" href="css/main.css">
Â  <link rel="stylesheet" href="css/realtime-updates.css">
Â  <style>
Â  Â  /* Existing styles... */
Â  Â  .cart-btn {
Â  Â  Â  position: relative;
Â  Â  Â  background: none;
Â  Â  Â  border: none;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-size: 20px;
Â  Â  Â  padding: 8px;
Â  Â  }
Â  Â  .cart-count {
Â  Â  Â  position: absolute;
Â  Â  Â  top: -5px;
Â  Â  Â  right: -5px;
Â  Â  Â  background: #dc3545;
Â  Â  Â  color: white;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 18px;
Â  Â  Â  height: 18px;
Â  Â  Â  font-size: 11px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  }
Â  Â  .gift-option:hover {
Â  Â  Â  border-color: #007bff;
Â  Â  Â  background: #f0f8ff;
Â  Â  }
Â  Â  /* New styles for form */
Â  Â  .form-group {
Â  Â  Â  margin-bottom: 15px;
Â  Â  }
Â  Â  .form-group label {
Â  Â  Â  display: block;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-bottom: 5px;
Â  Â  }
Â  Â  .form-group input, .form-group select {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 10px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  box-sizing: border-box;
Â  Â  }
Â  Â  .address-block {
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  padding: 15px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  background-color: #f9f9f9;
Â  Â  }
Â  Â  .address-block h4 {
Â  Â  Â  margin-top: 0;
Â  Â  Â  border-bottom: 1px solid #eee;
Â  Â  Â  padding-bottom: 10px;
Â  Â  Â  margin-bottom: 15px;
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <div style="text-align: center; margin: 20px 0;">
Â  Â  Â  <img src="logo.png" alt="Logo" style="height: 60px;">
Â  Â  </div>

Â  Â  <div id="nav-container"></div>

Â  Â  Â  Â  <div style="text-align: right; margin: 10px 0;">
Â  Â  Â  <button id="cart-button" class="cart-btn">
Â  Â  Â  Â  ğŸ›’
Â  Â  Â  Â  <span id="cart-count" class="cart-count" style="display: none;">0</span>
Â  Â  Â  </button>
Â  Â  </div>

Â  Â  <h1 style="text-align:center; margin-bottom:24px;">Custom Phone Cases</h1>


Â  Â  <div id="auth-action"></div>

Â  Â  <div id="token-display">
Â  Â  Â  <h2>Not signed in</h2>
Â  Â  </div>

Â  Â  <div id="app-content" style="display: none;">
Â  Â  Â  <div class="device-selection">
Â  Â  Â  Â  <h2>Select Your Phone Model to Start</h2>

Â  Â  Â  Â  <div class="brand-selection">
Â  Â  Â  Â  Â  <label class="brand-option">
Â  Â  Â  Â  Â  Â  <input type="radio" name="brand" value="apple" checked> Apple
Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  <label class="brand-option">
Â  Â  Â  Â  Â  Â  <input type="radio" name="brand" value="samsung"> Samsung
Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <label for="deviceSelect">Model:</label>
Â  Â  Â  Â  <select id="deviceSelect">
Â  Â  Â  Â  Â  <option value="">-- Choose Model --</option>
Â  Â  Â  Â  </select>

Â  Â  Â  Â  <div class="acknowledge-section" id="acknowledgeSection">
Â  Â  Â  Â  Â  <p style="margin: 0 0 10px 0; font-size: 14px;">
Â  Â  Â  Â  Â  Â  <strong>Important:</strong> For demonstration, we'll show your design on
Â  Â  Â  Â  Â  Â  <span id="demoDevice">iPhone 16 Pro Max</span>. Your actual order will be custom-made
Â  Â  Â  Â  Â  Â  specifically for your selected device: <strong id="selectedDevice"></strong>.
Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Â  <input type="checkbox" id="acknowledgeCheckbox">
Â  Â  Â  Â  Â  Â  I understand my case and wallpaper will be custom-made for:
Â  Â  Â  Â  Â  Â  <strong id="deviceName"></strong>
Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="promo-section" id="promoSection">
Â  Â  Â  Â  <h3>
Â  Â  Â  Â  Â  ğŸ’³ Have a Promo Code?
Â  Â  Â  Â  Â  <span id="activePromoBadge" class="active-promo-badge" style="display: none;">
Â  Â  Â  Â  Â  Â  Active: <span id="activePromoPercent">0</span>% OFF
Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  </h3>
Â  Â  Â  Â  <div class="promo-input-group">
Â  Â  Â  Â  Â  <input type="text" id="promoCodeInput" placeholder="Enter promo code">
Â  Â  Â  Â  Â  <button onclick="window.app.applyPromoCode()">Apply</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="promoMessage" class="promo-message"></div>
Â  Â  Â  </div>

Â  Â  Â  <div id="uploadSection" style="display:none;">
Â  Â  Â  Â  <h2>Upload 3 Images</h2>
Â  Â  Â  Â  <input type="file" id="fileInput" multiple accept="image/*">
Â  Â  Â  Â  <br>
Â  Â  Â  Â  <button onclick="window.app.uploadFiles()">Upload Images</button>
Â  Â  Â  Â  <div id="uploadResult"></div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="start-over-section" id="startOverSection">
Â  Â  Â  Â  <button class="start-over-btn" onclick="window.app.startOver()">
Â  Â  Â  Â  Â  Start Over with New Images
Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="auth-required-message" class="auth-required" style="display: none;">
Â  Â  Â  <h3>Authentication Required</h3>
Â  Â  Â  <p>Please sign in to access the phone case customization features.</p>
Â  Â  Â  <button onclick="signin()" style="padding: 10px 20px; background: #f90; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
Â  Â  Â  Â  Sign In / Sign Up
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>

Â  Â  <div id="cart-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
Â  Â  <div id="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 24px; border-radius: 12px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.15);">
Â  Â  Â  
Â  Â  Â  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
Â  Â  Â  Â  <h2 id="modal-title" style="margin: 0;">ğŸ›’ Shopping Cart</h2>
Â  Â  Â  Â  <button onclick="window.stripePayment.closeCartModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">Ã—</button>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div id="cart-view">
Â  Â  Â  Â  <div id="cart-items-container" style="margin-bottom: 20px; max-height: 300px; overflow-y: auto;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="gift-option" style="background: #f8fbff; padding: 16px; border: 2px solid #e6f2ff; border-radius: 8px; margin: 16px 0;">
Â  Â  Â  Â  Â  Â  <label style="display: flex; align-items: center; cursor: pointer; margin: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="gift-checkbox" style="width: 18px; height: 18px; margin-right: 12px; cursor: pointer;">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: 600; color: #0056b3; margin-bottom: 4px;">ğŸ Send as a gift</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="color: #666; font-size: 13px; line-height: 1.4;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  We'll wrap it beautifully and ship directly to your recipient
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="color: #d4af37; font-weight: 600; font-size: 13px; margin-top: 6px;">+ $12.00 gift service</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div style="border-top: 1px solid #eee; padding-top: 16px;">
Â  Â  Â  Â  Â  <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px;">
Â  Â  Â  Â  Â  Â  <span>Subtotal:</span>
Â  Â  Â  Â  Â  Â  <span>$<span id="cart-subtotal">0.00</span></span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div id="gift-fee-line" style="display: none; justify-content: space-between; margin-bottom: 8px; font-size: 14px;">
Â  Â  Â  Â  Â  Â  <span>Gift service:</span>
Â  Â  Â  Â  Â  Â  <span style="color: #d4af37;">$<span id="gift-fee">0.00</span></span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div id="tax-line" style="display: none; justify-content: space-between; margin-bottom: 8px; font-size: 14px;">
Â  Â  Â  Â  Â  Â  <span>Estimated Taxes:</span>
Â  Â  Â  Â  Â  Â  <span>$<span id="estimated-taxes">0.00</span></span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 18px; margin-bottom: 20px; padding-top: 8px; border-top: 1px solid #eee;">
Â  Â  Â  Â  Â  Â  <span>Total:</span>
Â  Â  Â  Â  Â  Â  <span style="color: #2c5530;">$<span id="cart-total">0.00</span></span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  <button onclick="window.stripePayment.showShippingStep()" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background: #007bff; color: white; border: none; padding: 16px; border-radius: 8px; width: 100%; cursor: pointer; font-size: 16px; font-weight: 600; transition: background 0.2s;">
Â  Â  Â  Â  Â  Â  Proceed to Checkout
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div id="checkout-view" style="display: none;">
Â  Â  Â  Â  <form id="checkout-form">
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="address-block">
Â  Â  Â  Â  Â  Â  <h4>ğŸšš Shipping Address</h4>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="shipping-name">Full Name</label>
Â  Â  Â  Â  Â  Â  Â  <input type="text" id="shipping-name" required>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="shipping-address">Address Line 1</label>
Â  Â  Â  Â  Â  Â  Â  <input type="text" id="shipping-address" required>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group" style="display: flex; gap: 10px;">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label for="shipping-city">City</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="shipping-city" required>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div style="flex-grow: 1;">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="shipping-state">State</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="shipping-state" required placeholder="e.g., CA or NY">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label for="shipping-zip">ZIP</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="shipping-zip" required>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label style="display: flex; align-items: center; font-weight: normal;">
Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="same-as-shipping" checked style="width: 18px; height: 18px; margin-right: 10px;">
Â  Â  Â  Â  Â  Â  Â  Billing address is the same as shipping address
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="billing-address-block" class="address-block" style="display: none;">
Â  Â  Â  Â  Â  Â  <h4>ğŸ’³ Billing Address</h4>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="billing-name">Full Name</label>
Â  Â  Â  Â  Â  Â  Â  <input type="text" id="billing-name">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="billing-address">Address Line 1</label>
Â  Â  Â  Â  Â  Â  Â  <input type="text" id="billing-address">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group" style="display: flex; gap: 10px;">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label for="billing-city">City</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="billing-city">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div style="flex-grow: 1;">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="billing-state">State</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="billing-state" placeholder="e.g., CA or NY">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label for="billing-zip">ZIP</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="billing-zip">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div style="display: flex; justify-content: space-between; gap: 10px; margin-top: 20px;">
Â  Â  Â  Â  Â  Â  <button type="button" onclick="window.stripePayment.showCartStep()" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background: #6c757d; color: white; border: none; padding: 16px; border-radius: 8px; width: 48%; cursor: pointer; font-size: 16px; font-weight: 600; transition: background 0.2s;">
Â  Â  Â  Â  Â  Â  Â  â† Back to Cart
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button type="submit" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style="background: #28a745; color: white; border: none; padding: 16px; border-radius: 8px; width: 48%; cursor: pointer; font-size: 16px; font-weight: 600; transition: background 0.2s;">
Â  Â  Â  Â  Â  Â  Â  Confirm & Pay â†’
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  
Â  Â  Â  Â  </form>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script src="config/constants.js"></script>
Â  <script src="js/auth.js"></script>
Â  <script src="js/device-manager.js"></script>
Â  <script src="js/promo-manager.js"></script>
Â  <script src="js/upload-manager.js"></script>

Â  Â  <script src="https://js.stripe.com/v3/"></script>
Â  <script src="js/stripe-payment.js"></script>
Â  <script src="js/websocket-manager.js"></script>
Â  <script src="js/progress-tracker.js"></script>
Â  <script src="js/ui-components-manager.js"></script>
Â  <script src="js/image-navigation-handler.js"></script>
Â  <script src="js/realtime-updates.js"></script>
Â  <script src="js/app.js"></script>

Â  <script>
Â  Â  // Initialize cart button
Â  Â  document.getElementById('cart-button').addEventListener('click', () => {
Â  Â  Â  window.stripePayment.openCartModal();
Â  Â  });
Â  Â  
Â  Â  // Setup for the Billing Address Toggle
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  const sameAsShippingCheckbox = document.getElementById('same-as-shipping');
Â  Â  Â  const billingAddressBlock = document.getElementById('billing-address-block');
Â  Â  Â  const checkoutForm = document.getElementById('checkout-form');
Â  Â  Â  
Â  Â  Â  if (sameAsShippingCheckbox && billingAddressBlock && checkoutForm) {
Â  Â  Â  Â  Â  // Toggle Billing Address Visibility
Â  Â  Â  Â  Â  sameAsShippingCheckbox.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  billingAddressBlock.style.display = e.target.checked ? 'none' : 'block';
Â  Â  Â  Â  Â  Â  window.stripePayment.updateTaxDisplay(); // Recalculate tax if state changes
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Tax Update Listener (on state change)
Â  Â  Â  Â  Â  document.getElementById('shipping-state').addEventListener('input', () => {
Â  Â  Â  Â  Â  Â  window.stripePayment.updateTaxDisplay();
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Handle Checkout Form Submission (to proceed to payment)
Â  Â  Â  Â  Â  checkoutForm.addEventListener('submit', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  window.stripePayment.proceedToPayment(); // Renamed from proceedToCheckout
Â  Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>
</html>
