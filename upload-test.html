<!DOCTYPE html>
<html>
<head>
    <title>Upload 3 Images</title>
    <style>
        .upload-box { border: 2px dashed #ccc; padding: 20px; margin: 10px; cursor: pointer; }
        .upload-box.active { border-color: blue; }
        button { margin: 10px; padding: 10px 20px; }
        button:disabled { opacity: 0.5; }
    </style>
</head>
<body>
    <h1>Upload 3 Images to S3</h1>
    
    <div class="upload-box" onclick="document.getElementById('file1').click()">
        <h3>Click Here to select Image 1</h3>
        <span id="name1">No file selected</span>
    </div>
    
    <div class="upload-box" onclick="document.getElementById('file2').click()">
        <h3>Click Here to select Image 2</h3>
        <span id="name2">No file selected</span>
    </div>
    
    <div class="upload-box" onclick="document.getElementById('file3').click()">
        <h3>Click Here to select Image 3</h3>
        <span id="name3">No file selected</span>
    </div>

    <input type="file" id="file1" style="display:none" onchange="handleFile(0, this.files[0])">
    <input type="file" id="file2" style="display:none" onchange="handleFile(1, this.files[0])">
    <input type="file" id="file3" style="display:none" onchange="handleFile(2, this.files[0])">

    <button onclick="resetAll()">Reset All</button>
    <button id="uploadBtn" onclick="uploadAll()" disabled>Click Here to Upload All</button>

    <div id="status"></div>

    <script>
        const API_URL = 'https://17dh48xerc.execute-api.us-east-1.amazonaws.com/first_stage/upload'; // Replace with your actual API Gateway URL
        const files = [null, null, null];

        function handleFile(index, file) {
            files[index] = file;
            document.getElementById(`name${index+1}`).textContent = file.name;
            document.querySelectorAll('.upload-box')[index].classList.add('active');
            
            // Enable upload button when all 3 files are selected
            if (files[0] && files[1] && files[2]) {
                document.getElementById('uploadBtn').disabled = false;
            }
        }

        function resetAll() {
            files.fill(null);
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`file${i}`).value = '';
                document.getElementById(`name${i}`).textContent = 'No file selected';
                document.querySelectorAll('.upload-box')[i-1].classList.remove('active');
            }
            document.getElementById('uploadBtn').disabled = true;
            document.getElementById('status').textContent = '';
        }

        async function uploadAll() {
            const status = document.getElementById('status');
            status.textContent = 'Uploading...';
            
            try {
                for (let i = 0; i < files.length; i++) {
                    status.textContent = `Uploading image ${i+1}...`;
                    
                    const file = files[i];
                    const reader = new FileReader();
                    
                    // Convert file to base64
                    const fileData = await new Promise((resolve) => {
                        reader.onload = (e) => resolve(e.target.result.split(',')[1]);
                        reader.readAsDataURL(file);
                    });
                    
                    // Send to Lambda
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            file: fileData,
                            fileName: file.name,
                            fileIndex: i,
                            contentType: file.type
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Failed to upload image ${i+1}`);
                    }
                }
                
                status.textContent = 'All images uploaded successfully!';
                document.getElementById('uploadBtn').disabled = true;
                
            } catch (error) {
                status.textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
