<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloom - Order Confirmed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- Dreamlike Elegance Theme --- */
        :root {
            --color-magenta: #E6007E;
            --color-gold: #D4AF37;
            --color-charcoal: #2E2E2E;
            --color-blush-start: #FFD0E6;
            --color-blush-end: #FFF7FB;
            --color-gray-300: #d1d5db;
            --color-gray-600: #4b5563;
        }
        
        .bg-magenta { background-color: var(--color-magenta); }
        .bg-gold { background-color: var(--color-gold); }
        .bg-gray-300 { background-color: var(--color-gray-300); }
        .text-white { color: white; }
        .text-gray-600 { color: var(--color-gray-600); }
        .border-magenta { border-color: var(--color-magenta); }
        .border-gold { border-color: var(--color-gold); }
        .border-gray-300 { border-color: var(--color-gray-300); }
        .text-magenta { color: var(--color-magenta); }
        .text-gold { color: var(--color-gold); }
        .font-semibold { font-weight: 600; }

        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Manrope:wght@400;600&display=swap');
        
        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--color-blush-end);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--color-charcoal);
        }
        .container {
            width: 100%;
            max-width: 960px;
            background: white;
            padding: 32px;
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        .header {
            border-bottom: 1px solid var(--color-blush-start);
        }
        h1, h2, h3, .poetic-title {
            font-family: 'Cormorant Garamond', serif;
            letter-spacing: 0.05em;
        }
        .poetic-title {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--color-charcoal);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .cta-magenta {
            background-color: var(--color-magenta);
            color: white;
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        .cta-magenta:hover {
            background-color: #C00063; 
            box-shadow: 0 4px 10px rgba(230, 0, 126, 0.4);
        }
        .cta-gold {
            background-color: var(--color-gold);
            color: var(--color-charcoal);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        .cta-gold:hover {
            background-color: #C09A34;
            box-shadow: 0 4px 10px rgba(212, 175, 55, 0.4);
        }
        .section-background {
            background: linear-gradient(135deg, var(--color-blush-start) 0%, var(--color-blush-end) 100%);
            padding: 20px;
            border-radius: 12px;
        }
        .gold-highlight {
            color: var(--color-gold);
            font-weight: 600;
        }
        .success-animation {
            animation: bloom 1s ease-out;
        }
        @keyframes bloom {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--color-magenta);
            opacity: 0;
            animation: confetti-fall 3s ease-in-out forwards;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header flex justify-between items-center pb-4 mb-6">
            <img src="logo.png" alt="Bloom" class="h-12 w-auto">
        </header>

        <main class="text-center">
            <!-- Success Icon -->
            <div class="success-animation mb-8">
                <div class="w-32 h-32 bg-green-100 rounded-full flex items-center justify-center mx-auto border-4 border-green-200">
                    <svg class="w-16 h-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
            </div>

            <!-- Main Success Message -->
            <h1 class="poetic-title text-4xl mb-6">Your Bloom is Complete</h1>
            
            <div class="text-center italic mb-8">
                <p class="text-xl text-gray-600 mb-4">"Your reflection has blossomed into art."</p>
            </div>

            <!-- Order Details -->
<!-- <div class="section-background max-w-2xl mx-auto mb-8"><h3 class="text-2xl font-semibold mb-4">Order Confirmation</h3><div class="text-left space-y-3 mb-6"><div class="flex justify-between"><span class="font-semibold">Order ID:</span><span id="order-id" class="gold-highlight">Loading...</span></div><div class="flex justify-between"><span class="font-semibold">Email:</span><span id="customer-email">Loading...</span></div><div class="flex justify-between"><span class="font-semibold">Total:</span><span id="order-total" class="gold-highlight">Loading...</span></div><div class="flex justify-between"><span class="font-semibold">Status:</span><span class="text-green-600 font-semibold">Payment Confirmed</span></div></div><div class="border-t pt-4"><p class="text-sm text-gray-600 mb-4">You'll receive email updates on your order.</p></div></div> -->

            <!-- Next Steps -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 max-w-4xl mx-auto">
                <div class="section-background p-6">
                    <div class="text-3xl mb-3">ðŸ“¦</div>
                    <h4 class="font-semibold mb-2">Production</h4>
                    <p class="text-sm text-gray-600">Your custom bloom begins production very soon.</p>
                </div>
                <!--
                <div class="section-background p-6">
                    <div class="text-3xl mb-3">ðŸšš</div>
                    <h4 class="font-semibold mb-2">Shipping</h4>
                    <p class="text-sm text-gray-600">Expect delivery in 5-7 business days after production.</p>
                </div>
                -->

                
                <div class="section-background p-6">
                    <div class="text-3xl mb-3">ðŸ’Œ</div>
                    <h4 class="font-semibold mb-2">Updates</h4>
                    <p class="text-sm text-gray-600">We'll email you at every step of the journey.</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
                <button onclick="window.location.href='https://www.theweer.com/case.html'" 
                        class="cta-magenta px-8 py-3 text-lg font-semibold rounded-full shadow-lg hover:shadow-xl">
                    Create Another Bloom
                </button>
                
                <!--
                <button onclick="viewOrderStatus()" 
                        class="cta-gold px-8 py-3 text-lg font-semibold rounded-full shadow-lg hover:shadow-xl">
                    Track Your Order
                </button>
                -->

            </div>

            <!-- Thank You Message -->
            <div class="section-background max-w-2xl mx-auto">
                <h3 class="text-xl font-semibold mb-3">Thank You for Choosing TheWeer.com</h3>
                <p class="text-gray-600 mb-2">
                    Your support helps us continue creating magical, personalized art for our community.
                </p>
                <p class="text-sm italic text-gray-500">
                    "From our studio to your hands â€” may your bloom bring daily joy."
                </p>
            </div>
        </main>
    </div>

    <footer class="w-full max-w-960px mt-12 py-8 border-t border-gray-200">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Contact -->
                <div>
                    <h3 class="font-bold text-lg mb-4">Contact</h3>
                    <p class="text-sm text-gray-600">Questions about your order?</p>
                    <a href="mailto:support@goldengateblooms.com" class="text-sm text-magenta hover:underline">support@goldengateblooms.com</a>
                </div>

                <!-- Legal Links -->
                <div>
                    <h3 class="font-bold text-lg mb-4">Legal</h3>
                    <div class="space-y-2">
                        <a href="/privacy-policy" class="block text-sm text-gray-600 hover:text-magenta transition-colors">Privacy Policy</a>
                        <a href="/terms-of-service" class="block text-sm text-gray-600 hover:text-magenta transition-colors">Terms of Service</a>
                    </div>
                </div>
                
                <!-- Company Info -->
                <div>
                    <h3 class="font-bold text-lg mb-4">GOLDEN GATE BLOOMS LLC</h3>
                    <address class="not-italic text-sm text-gray-600">
                        <p>3400 COTTAGE WAY</p>
                        <p>STE G2</p>
                        <p>SACRAMENTO, CA 95825</p>
                    </address>
                </div>
            </div>
            
            <div class="border-t border-gray-200 mt-8 pt-6 text-center">
                <p class="text-sm text-gray-500">&copy; 2025 Golden Gate Blooms LLC. All rights reserved.</p>
            </div>
        </div>
    </footer>
        <script>
            // Create confetti effect
            function createConfetti() {
                console.log('ðŸŽŠ Launching confetti celebration!');
                const colors = ['#E6007E', '#D4AF37', '#FFD0E6', '#2E2E2E'];
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }
                console.log('âœ… Confetti animation started');
            }
        
            // Initialize page
            document.addEventListener('DOMContentLoaded', function() {
                createConfetti();
            });
        
            // Log any errors that occur during page load
            window.addEventListener('error', function(e) {
                console.error('ðŸ’¥ Page error:', e.error);
            });
        </script>
    <!-- Gift Note Modal -->
<div id="giftNoteModal" class="fixed inset-0 z-50 overflow-y-auto" style="display: none;">
  <div class="flex min-h-screen items-center justify-center p-4">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black bg-opacity-50" aria-hidden="true"></div>
    
    <!-- Modal Content -->
    <div class="relative bg-white rounded-2xl shadow-xl max-w-md w-full mx-auto p-6">
      <!-- Header -->
      <div class="text-center mb-6">
        <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-magenta" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">Personal Gift Note</h3>
        <p class="text-gray-600 text-sm">
          Add a personal message for your gift-wrapped order
        </p>
      </div>
      
      <!-- Form -->
      <div class="mb-6">
        <textarea 
          id="giftNoteTextarea" 
          rows="4" 
          maxlength="500"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-magenta focus:border-transparent resize-none placeholder-gray-400"
          placeholder="Write your heartfelt message here... (optional)"></textarea>
        <div class="mt-2 flex justify-between items-center">
          <span class="text-xs text-gray-500">Maximum 500 characters</span>
          <span id="charCount" class="text-xs text-gray-500">0/500</span>
        </div>
      </div>
      
      <!-- Buttons -->
      <div class="flex gap-3">
        <button 
          id="skipGiftNoteBtn"
          type="button"
          class="flex-1 px-4 py-3 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
          Skip
        </button>
        <button 
          id="submitGiftNoteBtn"
          type="button"
          class="flex-1 px-4 py-3 text-sm font-medium text-white bg-magenta hover:bg-opacity-90 rounded-lg transition-colors">
          Save Note
        </button>
      </div>
    </div>
  </div>
</div>
    <script>
// Gift Note Handler - Follows same pattern as StripeCheckout
class GiftNoteHandler {
    constructor() {
        this.modal = document.getElementById('giftNoteModal');
        this.textarea = document.getElementById('giftNoteTextarea');
        this.charCount = document.getElementById('charCount');
        this.submitBtn = document.getElementById('submitGiftNoteBtn');
        this.skipBtn = document.getElementById('skipGiftNoteBtn');
        
        // Get order ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        this.orderId = urlParams.get('order_id');
        
        if (!this.orderId) {
            console.log('No order ID found');
            return;
        }
        
        // Use the same endpoint as StripeCheckout
        this.API_ENDPOINT = CONFIG.CHECKOUT_API_ENDPOINT;
        
        this.init();
    }
    
    async init() {
        // Check if this order has gift wrapping
        const hasGiftWrapping = await this.checkOrderHasGiftWrapping();
        
        if (hasGiftWrapping) {
            // Show modal after short delay
            setTimeout(() => this.showModal(), 1000);
        } else {
            // No gift wrapping, proceed with celebration
            this.startCelebration();
        }
        
        this.setupEventListeners();
    }
    
    async checkOrderHasGiftWrapping() {
        try {
            // Call getOrderDetails to check if order has gift wrapping
            const response = await fetch(this.API_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'getOrderDetails',
                    order_id: this.orderId
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to get order details');
            }
            
            const data = await response.json();
            
            // Return true only if order has gift wrapping
            return data.has_gift_wrapping === true;
            
        } catch (error) {
            console.error('Error checking order:', error);
            // If we can't check, assume no gift wrapping to avoid false positives
            return false;
        }
    }
    
    showModal() {
        this.modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
        setTimeout(() => this.textarea.focus(), 100);
    }
    
    hideModal() {
        this.modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    setupEventListeners() {
        // Character counter
        this.textarea.addEventListener('input', () => {
            const length = this.textarea.value.length;
            this.charCount.textContent = `${length}/500`;
            this.charCount.className = `text-xs ${length > 450 ? 'text-red-500' : 'text-gray-500'}`;
        });
        
        // Submit button
        this.submitBtn.addEventListener('click', async () => {
            await this.saveGiftNote();
        });
        
        // Skip button
        this.skipBtn.addEventListener('click', () => {
            this.hideModal();
            this.startCelebration();
        });
        
        // Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && this.modal.style.display === 'block') {
                this.hideModal();
                this.startCelebration();
            }
        });
    }
    
    async saveGiftNote() {
        const note = this.textarea.value.trim();
        
        // Show loading state
        const originalText = this.submitBtn.textContent;
        this.submitBtn.textContent = 'Saving...';
        this.submitBtn.disabled = true;
        
        try {
            // Save the gift note
            const response = await fetch(this.API_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'updateOrderGiftNote',
                    order_id: this.orderId,
                    gift_note: note
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to save note');
            }
            
            const result = await response.json();
            
            // Show success feedback
            this.submitBtn.textContent = 'âœ“ Saved!';
            this.submitBtn.className = 'flex-1 px-4 py-3 text-sm font-medium text-white bg-green-500 rounded-lg transition-colors';
            this.submitBtn.disabled = true;
            
            // Close modal and celebrate after a moment
            setTimeout(() => {
                this.hideModal();
                this.startCelebration();
            }, 1000);
            
        } catch (error) {
            console.error('Error saving gift note:', error);
            
            // Show error but still allow them to continue
            alert(`Note: ${error.message}. You can continue without saving the note.`);
            
            // Reset button and continue
            this.submitBtn.textContent = originalText;
            this.submitBtn.disabled = false;
            this.hideModal();
            this.startCelebration();
        }
    }
    
    startCelebration() {
        // Trigger confetti celebration
        if (typeof createConfetti === 'function') {
            createConfetti();
        }
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    // Wait for CONFIG to be available (same as StripeCheckout does)
    setTimeout(() => {
        if (window.CONFIG && window.CONFIG.CHECKOUT_API_ENDPOINT) {
            new GiftNoteHandler();
        } else {
            console.log('CONFIG not available, skipping gift note handler');
            // Still trigger celebration
            if (typeof createConfetti === 'function') {
                createConfetti();
            }
        }
    }, 500);
});
</script>
</body>
</html>
