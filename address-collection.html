<!-- checkout.html -->
<div id="app-content" style="display: none;">
    <h1>Checkout</h1>
    <p>Product: $1.00</p>
    
    <div class="gift-option">
        <label>
            <input type="checkbox" id="is-gift"> 
            üéÅ Wrap it and send it to an address - it's a gift! (+$12)
        </label>
    </div>
    
    <button id="proceed-to-payment">Proceed to Payment</button>
</div>

<script>
const stripe = Stripe('pk_test_51SMYv7DBeWU7VJzLNGNEY9wllekcfhQZaMndBcGbvbK5zA7gROVkeWX5lAd8By9QCXVqAinfe5TkHlURcml7Eky700lHbTzbU1');

document.getElementById('proceed-to-payment').addEventListener('click', async () => {
    const isGift = document.getElementById('is-gift').checked;
    const totalAmount = isGift ? 112 : 100; // $1 + $12 gift fee
    
    try {
        const session = getSession();
        const userInfo = getUserInfo();
        
        const response = await fetch('https://y4vn8tdr5g.execute-api.us-east-1.amazonaws.com/prod/upload', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${session.id_token}`
            },
            body: JSON.stringify({
                action: 'createCheckoutSession',
                user_email: userInfo ? userInfo.email : null,
                is_gift: isGift,
                amount: totalAmount
            })
        });

        const checkoutSession = await response.json();
        
        const result = await stripe.redirectToCheckout({
            sessionId: checkoutSession.id
        });

        if (result.error) throw new Error(result.error.message);
        
    } catch (error) {
        alert('Error: ' + error.message);
    }
});
</script>
